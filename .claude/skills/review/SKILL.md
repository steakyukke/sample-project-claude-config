---
name: review
description: Code review checklist, security, performance, accessibility
---

# Review Skill

## Overview

コードレビュー（セルフレビュー含む）のためのチェックリストとガイドライン。

## レビュー観点

### 1. セキュリティ

| 項目 | 確認内容 |
|------|----------|
| 認証・認可 | 適切な認証チェックがあるか、RLSが設定されているか |
| 入力バリデーション | Zodでフロント・バック両方で検証しているか |
| SQLインジェクション | Drizzle ORMのクエリビルダーを使用しているか |
| XSS | ユーザー入力をエスケープしているか |
| 機密情報 | APIキー・トークンがハードコードされていないか |
| 環境変数 | `.env` に機密情報が含まれ、コミットされていないか |

### 2. パフォーマンス

| 項目 | 確認内容 |
|------|----------|
| N+1問題 | ループ内でDBクエリを発行していないか |
| 不要な再レンダリング | 適切にメモ化されているか |
| バンドルサイズ | 大きなライブラリをClient Componentでインポートしていないか |
| 画像最適化 | `next/image` を使用しているか |
| データフェッチ | Server Componentで直接取得しているか |

### 3. アクセシビリティ

| 項目 | 確認内容 |
|------|----------|
| セマンティックHTML | 適切なHTML要素を使用しているか |
| キーボード操作 | Tab/Enterで操作可能か |
| aria属性 | 必要な箇所に設定されているか |
| コントラスト | テキストが読みやすいか |
| フォームラベル | すべての入力にラベルがあるか |

### 4. コード品質

| 項目 | 確認内容 |
|------|----------|
| 型安全性 | `any` を使用していないか |
| エラーハンドリング | 適切にtry-catchしているか |
| コメント | 複雑なロジックに「なぜ」を説明しているか |
| 命名 | 変数・関数名が意図を表しているか |
| 重複 | 同じロジックが複数箇所にないか |
| デッドコード | 使われていないコードがないか |

### 5. テスト

| 項目 | 確認内容 |
|------|----------|
| カバレッジ | 重要なロジックにテストがあるか |
| エッジケース | 境界値・異常系をテストしているか |
| モック | 外部依存を適切にモックしているか |

## チェックリスト（コピペ用）

```markdown
## セルフレビューチェックリスト

### セキュリティ
- [ ] 認証・認可チェックが適切
- [ ] 入力バリデーション（Zod）が実装済み
- [ ] 機密情報がハードコードされていない

### パフォーマンス
- [ ] N+1問題がない
- [ ] Server Componentでデータフェッチ

### コード品質
- [ ] `any` 型を使用していない
- [ ] エラーハンドリングが適切
- [ ] デッドコードがない

### テスト
- [ ] 重要なロジックにテストがある
```

## レビューコメント例

### 問題を指摘する場合

```
[セキュリティ] ユーザー入力がエスケープされていません。
XSS脆弱性の可能性があります。

修正案:
- `dangerouslySetInnerHTML` の使用を避ける
- または DOMPurify でサニタイズする
```

### 改善を提案する場合

```
[パフォーマンス] このクエリはループ内で実行されています。
N+1問題が発生する可能性があります。

提案:
- `Promise.all` でバッチ処理する
- または事前に一括取得する
```

## OWASP Top 10 チェック

1. **インジェクション** - Drizzle ORM使用でOK
2. **認証の不備** - Supabase Auth使用、RLS設定確認
3. **機密データの露出** - 環境変数確認、ログ出力確認
4. **XXE** - N/A（XMLを使用していない）
5. **アクセス制御の不備** - RLS、ホワイトリスト確認
6. **セキュリティ設定のミス** - 本番環境のヘッダー確認
7. **XSS** - React自動エスケープ、dangerouslySetInnerHTML確認
8. **安全でないデシリアライゼーション** - Zodバリデーション確認
9. **既知の脆弱性** - `npm audit` 実行
10. **不十分なロギング** - 適切なエラーログ確認
